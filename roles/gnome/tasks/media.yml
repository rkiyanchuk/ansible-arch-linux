---
- name: install udiskie for automount
  pacman:
    name: udiskie

- name: install Intel Video Acceleration API driver
  pacman:
    name:
      - intel-media-driver

- name: install media codecs
  pacman:
    name:
      - flac
      - lame
      - opus
      - gstreamer
      - gst-libav
      - gstreamer-vaapi
      - gst-plugins-good
      - gst-plugins-ugly
      - gst-plugins-bad

- name: install pulseaudio
  pacman:
    name:
      - pipewire
      - pipewire-docs
      - pipewire-alsa
      - pipewire-pulse
      - libpipewire02  # For Chrome screen sharing to work as long as they ship with v0.2
      - pavucontrol
      - pamixer
      - paprefs

- name: load bluez5 module in pipewire
  lineinfile:
    path: /etc/pipewire/pipewire.conf
    regexp: '^exec /usr/bin/pipewire-media-session'
    line: "exec /usr/bin/pipewire-media-session -e bluez5"

- name: install Pipewire JACK dropin
  aur:
    name: "pipewire-jack-dropin"
  become: yes
  become_user: "{{ user.name }}"


- name: install packages for audio recording and editing
  pacman:
    name:
      - ardour
      - cadence
      - lv2-plugins
      # - dssi-plugins
      # - ladspa-plugins
      # - vst-plugins

- meta: flush_handlers